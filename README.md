# Проект для поиска по базе данных с использованием BM25 и эмбеддингов

Этот проект представляет собой API для индексации данных из xlsx-файлов и поиска по ним с использованием векторного поиска (эмбеддинги) и лексического поиска (BM25).

## Структура проекта

- `docker-compose.yml`: Файл для развертывания проекта с помощью Docker Compose. Включает в себя сервисы `qdrant`, `ollama` и `api`.
- `Dockerfile`: Файл для сборки Docker-образа API.
- `api/`: Директория с кодом API.
  - `main.py`: Основной файл с FastAPI-приложением.
- `static/`: директория с файлами для веб-интерфейса.
  - `requirements.txt`: Файл с зависимостями Python.
- `README.md`: Инструкция по использованию проекта.

## Инструкция по использованию

### 1. Развертывание

Вы можете развернуть проект с помощью Portainer или любой другой системы, поддерживающей Docker Compose.

1.  Создайте новый стек (stack) в Portainer.
2.  Скопируйте содержимое файла `docker-compose.yml` в редактор стека.
3.  Нажмите "Deploy the stack".

### 2. Индексация данных

#### Загрузка основного файла

Для индексации данных из вашего основного xlsx-файла, отправьте POST-запрос на эндпоинт `/upload_xlsx`.

**Пример с использованием `curl`:**
```bash
curl -X POST -F "file=@/путь/к/вашему/файлу.xlsx" -F "collection_name=my_collection" http://localhost:8000/upload_processed_xlsx
```

**Требования к файлу:**
- Файл должен быть в формате `.xlsx`.
- Файл должен содержать столбцы "Артикул", "Наименование" и "Тариф с НДС, руб".

#### Обновление остатков

Для обновления информации об остатках, отправьте POST-запрос на эндпоинт `/update_stock`.

**Пример с использованием `curl`:**
```bash
curl -X POST -F "file=@/путь/к/файлу/остатков.xlsx" -F "stock_column=Название Столбца" http://localhost:8000/update_stock
```

**Требования к файлу:**
- Файл должен быть в формате `.xlsx`.
- Файл должен содержать столбец "Артикул" для сопоставления.
- В параметре `stock_column` необходимо указать точное название столбца, в котором находятся данные об остатках.

### 3. Поиск

Для выполнения поиска, отправьте GET-запрос на эндпоинт `/search` с параметром `query`.

**Пример с использованием `curl`:**
```bash
curl -X GET "http://localhost:8000/search?query=ваш поисковый запрос&collection_name=my_collection"
```

**Ответ:**

Ответ будет содержать два списка результатов:
- `vector_search_results`: Результаты векторного поиска.
- `bm25_search_results`: Результаты лексического поиска (BM25).
# lolix
