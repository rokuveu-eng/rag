# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ Excel (Qdrant + Ollama + FastEmbed)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî –≥–æ—Ç–æ–≤—ã–π API –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `.xlsx` –∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∏–º. 
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Qdrant Query API** (v1.10+) —Å **Fusion RRF**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞** (dense) –∏ **–ª–µ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞** (sparse).

---

## üöÄ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ‚úÖ Qdrant (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞)
–•—Ä–∞–Ω–∏—Ç:
- `text-dense` ‚Äî –ø–ª–æ—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (Ollama / bge-m3)
- `text-sparse` ‚Äî —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (FastEmbed / SPLADE)

### ‚úÖ Ollama
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è dense-–≤–µ–∫—Ç–æ—Ä–æ–≤.
–ú–æ–¥–µ–ª—å: **bge-m3**.

### ‚úÖ FastEmbed
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è sparse-–≤–µ–∫—Ç–æ—Ä–æ–≤ (SPLADE).
–ú–æ–¥–µ–ª—å: **prithivida/Splade_PP_en_v1**.

### ‚úÖ FastAPI API
–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ Qdrant –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
[Excel (.xlsx)]
      ‚Üì
 FastAPI API
      ‚Üì
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ Ollama     ‚îÇ    ‚îÇ FastEmbed  ‚îÇ
  ‚îÇ (bge-m3)   ‚îÇ    ‚îÇ (SPLADE)   ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚Üì                  ‚Üì
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
         Qdrant
      (dense + sparse)
             ‚Üì
      Fusion RRF Query
             ‚Üì
         –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

---

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker / Docker Compose
- Qdrant Client **>= 1.10.0**
- NVIDIA GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è Ollama)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **nvidia-container-toolkit** –Ω–∞ —Ö–æ—Å—Ç–µ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ GPU)

> Qdrant —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU –∏ **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç** GPU. –û–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å GPU‚Äë—Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ä—è–¥–æ–º.

---

## üß© –ó–∞–ø—É—Å–∫

```bash
docker compose up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- Qdrant: http://localhost:6338
- API: http://localhost:8424

> –í–Ω—É—Ç—Ä–∏ docker‚Äë—Å–µ—Ç–∏ API –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–∏—Å—É `ollama` –ø–æ –∞–¥—Ä–µ—Å—É `http://ollama:11434`.
> –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ API **–≤–Ω–µ Docker**, —É–∫–∞–∂–∏—Ç–µ `OLLAMA_BASE_URL=http://localhost:11435`.

---

## üì• –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è Excel

–≠–Ω–¥–ø–æ–∏–Ω—Ç:
```
POST /upload_processed_xlsx
```

### –ü—Ä–∏–º–µ—Ä curl:
```bash
curl -X POST \
  -F "file=@/path/to/data.xlsx" \
  -F "skip_rows=0" \
  -F "mappings={\"–ê—Ä—Ç–∏–∫—É–ª\":0,\"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ\":1,\"–¢–∞—Ä–∏—Ñ —Å –ù–î–°, —Ä—É–±\":2}" \
  -F "collection_name=my_collection" \
  -F "batch_size=16" \
  http://localhost:8424/upload_processed_xlsx
```

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:
- `skip_rows` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º.
- `mappings` ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–æ–∫ (–∏–Ω–¥–µ–∫—Å—ã –∏–¥—É—Ç —Å 0).
- `batch_size` ‚Äî —Ä–∞–∑–º–µ—Ä –ø–∞—á–∫–∏ –¥–ª—è –±–∞—Ç—á‚Äë–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ dense —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ Ollama.

> –ë–∞—Ç—á–∏–Ω–≥ —É—Å–∫–æ—Ä—è–µ—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ. –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `/api/embed` (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Ollama),
> –∏–Ω–∞—á–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/embeddings`.

---

## üîç –ü–æ–∏—Å–∫

–≠–Ω–¥–ø–æ–∏–Ω—Ç:
```
GET /search
```

### –ü—Ä–∏–º–µ—Ä curl:
```bash
curl -G "http://localhost:8424/search" \
  --data-urlencode "collection_name=my_collection" \
  --data-urlencode "query=–ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å"
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è dense-–≤–µ–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ Ollama (`bge-m3`)
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è sparse-–≤–µ–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ FastEmbed (SPLADE)
3. Qdrant –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ **Fusion RRF** (`query_points + prefetch`)

> Ollama –∑–∞–ø—É—â–µ–Ω–∞ —Å GPU (–µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω), —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é dense‚Äë–≤–µ–∫—Ç–æ—Ä–æ–≤.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤ Qdrant (–Ω–æ–≤—ã–π API)

```python
client.query_points(
    collection_name="my_collection",
    prefetch=[
        models.Prefetch(
            query=sparse_vector,
            using="text-sparse",
            limit=20,
        ),
        models.Prefetch(
            query=dense_vector,
            using="text-dense",
            limit=20,
        ),
    ],
    query=models.FusionQuery(fusion=models.Fusion.RRF),
    limit=10,
    with_payload=True,
)
```

---

## üí° –í–∞–∂–Ω–æ
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ FastEmbed —Å–∫–∞—á–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å SPLADE —Å Hugging Face (–æ–∫–æ–ª–æ 500MB).
- Ollama —Å–∫–∞—á–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å `bge-m3` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ GPU Ollama –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ CPU.

---

## üìå –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Portainer

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Stack
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `docker-compose.yml`
3. –ù–∞–∂–º–∏—Ç–µ Deploy

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –¥–æ–±–∞–≤–ª—é —Ä–∞–∑–¥–µ–ª —Å API –æ—à–∏–±–∫–∞–º–∏, –≤–æ–∑–≤—Ä–∞—Ç–æ–º payload –∏–ª–∏ —Å—Ö–µ–º–æ–π –¥–∞–Ω–Ω—ã—Ö.
